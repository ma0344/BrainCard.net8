# ISSUE-005-03 点列の座標系（DIP）とサンプリング方針を確定する

## ゴール
- ポインタ入力で収集する点列 `p[]` の座標系を **DIP** として確定し、サンプリング方針（点の追加条件）を仕様化する

## スコープ（作業内容）
- 座標系
  - WPFのDPIスケールとSwapChain（ピクセル）との関係を整理する
  - v2ストロークモデル上の座標単位を **DIP** に統一する
- サンプリング
  - 移動イベント毎に点を追加する（最小）
  - 点列肥大化を避けるため、必要なら最小距離閾値（DIP）を設ける

## 非対象（Non-goals）
- スムージング/ベジェ化
- 速度推定や`t`の補完（別ステップ）

## 定義
- DIP（Device Independent Pixel）
  - WPFと同じく **1/96 inch** を基準とする論理座標
- Pixel（物理解像度）
  - SwapChainのバッファサイズ、`WM_*`の座標が基準とする物理座標

## 決定
- 収集点列 `p[]` の `x,y` は **DIP** で保持する
- SwapChainのバッファサイズは **Pixel** で管理する

## 変換の責務
- `DxSwapChainHost`（`HwndHost`）
  - 子HWNDが受け取る座標（基本はPixel）を、DPIスケールを用いて **DIPへ変換**して上位へ通知する
  - DPI取得はWPFのDPI（`PresentationSource`/`VisualTreeHelper`相当）を優先し、取得できない場合はフォールバックを用意する
- `SubWindow`
  - 受け取ったDIP座標を **そのまま点列として保持**する
  - 描画（後続）でPixel変換が必要な場合は、描画側で処理する

## 描画属性との関係（ISSUE-005-04）
- 線幅は `widthDip` として **DIP** で持ち、見た目の一貫性を優先する
- 筆圧は最小到達点では一定値で代替し、ペン入力導入後に点ごとの筆圧へ拡張する

## サンプリング方針
- 最小方針
  - **移動イベント毎に点を追加**してよい
- 点列肥大化の抑制（推奨）
  - 直前点との距離が `minDistanceDip` 以上のときのみ点を追加する
  - `minDistanceDip` 初期値: **0.5 DIP**（暫定。後でチューニング可能）
- クリックのみ（移動なし）
  - **1点ストロークとして扱う**（`Down`時の点、または`Up`時の点）

## 受け入れ基準
- 100%/150% DPI環境で同じ見た目のドラッグをしたとき、DIPの点列が同じスケール感で蓄積される
- 実装者が「どの座標を保存モデルに入れるべきか」を判断できる文章化がある

## 検証
- review: DPI 100%/150% 等で同じ描画が同じ見た目サイズになる前提が成り立つことをレビューする

## リスク
- 早期に座標系を誤ると全保存データの互換に影響 - DIP基準で固定し、必要なら描画時に変換する
